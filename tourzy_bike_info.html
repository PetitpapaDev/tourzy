<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    
    <style>html, body {width: 100%; height: 100%; margin: 0; padding: 0;}</style>
    <style>#map {position:absolute; top:0; bottom:0; right:0; left:0;}</style>

    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
            
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <style>
        #map {
            position: relative;
            width: 100.0%;
            height: 100.0%;
            left: 0.0%;
            top: 0.0%;
        }

        #updated {
            width: 100%;
            text-align: center;
            position: fixed;
            top: 0%;
            padding-top: 10px;
            padding-bottom: 10px;

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            color: #000000;
            background: #FF7500;

            z-index: 9999;
        }

        #copied {
            width: 300px;
            height: 50px;
            text-align: center;
            position: fixed;
            bottom: 10%;
            left: 50%;
            transform: translate(-50%, 0%);

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            line-height: 50px;
            color: #000000;
            background: #FF7500;
            border-radius: 10px;

            z-index: 9999;
        }
    </style>
        
</head>

<script>

    var map
    var tile_layer
    var marker
    var icon
    var popup
    var html

    var tourzy_bike = 



[{"car":"TZ0271","lock":"열림","fuel":10,"lock_fuel":95,"lat":"35.180271300789386","lng":"129.1705190584899","lastest":45143.37539351852,"address":"대한민국 부산광역시 해운대구 좌동 1388","etc":"미잠금"},{"car":"TZ0055","lock":"열림","fuel":73,"lock_fuel":98,"lat":"35.16695999576173","lng":"129.18091634248682","lastest":45143.37503472222,"address":"대한민국 부산광역시 대우.상록아파트","etc":"미잠금"},{"car":"TZ0180","lock":"열림","fuel":77,"lock_fuel":98,"lat":"35.14653437150489","lng":"129.11269783148433","lastest":45143.3753125,"address":"대한민국 부산광역시 수영구 광남로48번길 17","etc":"미잠금"},{"car":"TZ0295","lock":"열림","fuel":82,"lock_fuel":98,"lat":"35.160767814174555","lng":"129.16143777198576","lastest":45143.37550925926,"address":"대한민국 부산광역시 해운대구 중동 1392-169","etc":"미잠금"},{"car":"TZ0354","lock":"잠김","fuel":0,"lock_fuel":1,"lat":"35.16350658767668","lng":"129.1364797554572","lastest":45142.47170138889,"address":"대한민국 부산광역시 해강중고교","etc":"회수"},{"car":"TZ0004","lock":"잠김","fuel":0,"lock_fuel":51,"lat":"35.194755697173804","lng":"129.20883844398003","lastest":45143.37030092593,"address":"대한민국 부산광역시 기장군 기장읍 당사리 521","etc":"배터리"},{"car":"TZ0083","lock":"잠김","fuel":0,"lock_fuel":51,"lat":"35.135402287067805","lng":"129.10091768133375","lastest":45143.36844907407,"address":"대한민국 부산광역시 남구 용소로 21","etc":"배터리"},{"car":"TZ0409","lock":"잠김","fuel":0,"lock_fuel":56,"lat":"35.19483339801562","lng":"129.20860026212455","lastest":45143.37648148148,"address":"대한민국 부산광역시 기장군 기장읍 당사리 521","etc":"배터리"},{"car":"TZ0494","lock":"잠김","fuel":0,"lock_fuel":91,"lat":"35.15550357752118","lng":"129.12356869707506","lastest":45143.37546296296,"address":"대한민국 부산광역시 수영구 민락동 181-84","etc":"배터리"},{"car":"TZ0271","lock":"열림","fuel":10,"lock_fuel":95,"lat":"35.180271300789386","lng":"129.1705190584899","lastest":45143.37539351852,"address":"대한민국 부산광역시 해운대구 좌동 1388","etc":"배터리"},{"car":"TZ0036","lock":"잠김","fuel":10,"lock_fuel":95,"lat":"35.16103178640714","lng":"129.17144019687643","lastest":45143.37190972222,"address":"대한민국 부산광역시 해운대구 중동 941-9","etc":"배터리"},{"car":"TZ0050","lock":"잠김","fuel":10,"lock_fuel":95,"lat":"35.165540588241576","lng":"129.11586864121907","lastest":45143.37113425926,"address":"대한민국 부산광역시 수영구 광안동 무학로9번길 86","etc":"배터리"},{"car":"TZ0131","lock":"잠김","fuel":10,"lock_fuel":98,"lat":"35.155455636647375","lng":"129.12182204073923","lastest":45143.37171296297,"address":"대한민국 부산광역시 수영구 민락동 177-3","etc":"배터리"},{"car":"TZ0153","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.143856280650404","lng":"129.09837676278883","lastest":45143.3710300926,"address":"대한민국 부산광역시 대연삼정그린코아더베스트","etc":"배터리"},{"car":"TZ0237","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.16821009495343","lng":"129.17397535432474","lastest":45143.37582175926,"address":"대한민국 부산광역시 해운대구 중동 262-1","etc":"배터리"},{"car":"TZ0389","lock":"잠김","fuel":11,"lock_fuel":96,"lat":"35.14023411734042","lng":"129.10371804653033","lastest":45143.37070601852,"address":"대한민국 부산광역시 남구 수영로","etc":"배터리"},{"car":"TZ0029","lock":"잠김","fuel":13,"lock_fuel":95,"lat":"35.13849983159532","lng":"129.0680000342262","lastest":45143.37462962963,"address":"대한민국 부산광역시 남구 문현동 379-25","etc":"배터리"},{"car":"TZ0065","lock":"잠김","fuel":13,"lock_fuel":96,"lat":"35.16744650497447","lng":"129.16661987943678","lastest":45143.36981481482,"address":"대한민국 부산광역시 해운대구 중동 1754-2 1207호","etc":"배터리"},{"car":"TZ0106","lock":"잠김","fuel":13,"lock_fuel":97,"lat":"35.16131599607961","lng":"129.1580588481602","lastest":45143.37023148148,"address":"대한민국 부산광역시 해운대구 구남로18번길 36","etc":"배터리"},{"car":"TZ0246","lock":"잠김","fuel":13,"lock_fuel":96,"lat":"35.16075804827718","lng":"129.1076094028735","lastest":45143.37306712963,"address":"대한민국 부산광역시 수영구 광일로29번가길 58","etc":"배터리"},{"car":"TZ0405","lock":"잠김","fuel":13,"lock_fuel":96,"lat":"35.15713294899289","lng":"129.12475151096632","lastest":45143.37642361111,"address":"대한민국 부산광역시 민락동 35-16번지 수영구 부산광역시 KR","etc":"배터리"},{"car":"TZ0024","lock":"잠김","fuel":14,"lock_fuel":97,"lat":"35.16239871255756","lng":"129.1759783933337","lastest":45143.37207175926,"address":"대한민국 부산광역시 해운대구 좌동순환로412번길 8","etc":"배터리"},{"car":"TZ0032","lock":"잠김","fuel":14,"lock_fuel":95,"lat":"35.15724481027386","lng":"129.1246593582596","lastest":45143.37334490741,"address":"대한민국 부산광역시 수영구 민락동 36-45","etc":"배터리"},{"car":"TZ0100","lock":"잠김","fuel":14,"lock_fuel":96,"lat":"35.1606238366968","lng":"129.1697360091696","lastest":45143.37188657407,"address":"대한민국 부산광역시 해운대구 중동 1831","etc":"배터리"},{"car":"TZ0204","lock":"잠김","fuel":14,"lock_fuel":96,"lat":"35.15936406297542","lng":"129.1564027558775","lastest":45143.36975694444,"address":"대한민국 부산광역시 해운대구 우동 649-1","etc":"배터리"},{"car":"TZ0310","lock":"잠김","fuel":14,"lock_fuel":96,"lat":"35.16891135997535","lng":"129.15611767394813","lastest":45143.36975694444,"address":"대한민국 부산광역시 해운대구 우동 380-16","etc":"배터리"},{"car":"TZ0386","lock":"잠김","fuel":14,"lock_fuel":96,"lat":"35.156609369282535","lng":"129.12251184319868","lastest":45143.37306712963,"address":"대한민국 부산광역시 수영구 민락동 221-2","etc":"배터리"},{"car":"TZ0042","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.15306236015999","lng":"129.06543686410444","lastest":45143.37225694444,"address":"대한민국 부산광역시 부산진구 전포동 전포대로","etc":"배터리"},{"car":"TZ0058","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.17916717516638","lng":"129.07311751897043","lastest":45143.36925925926,"address":"대한민국 부산광역시 연제구 연산동 1000-14","etc":"배터리"},{"car":"TZ0078","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.17004536054677","lng":"129.1410939546515","lastest":45143.37076388889,"address":"대한민국 부산광역시 해운대구 우동 1102-75","etc":"배터리"},{"car":"TZ0119","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.13728145783919","lng":"129.10075853390745","lastest":45143.37277777777,"address":"대한민국 부산광역시 남구 수영로 312, 1008호(대연동, 21C센츄리오피스텔)","etc":"배터리"},{"car":"TZ0171","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.16778695282305","lng":"129.13439329575007","lastest":45143.37075231481,"address":"대한민국 부산광역시 벡스코","etc":"배터리"},{"car":"TZ0193","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.1266591020731","lng":"129.10711196726436","lastest":45143.37258101852,"address":"대한민국 부산광역시 남구 용호제1동 179-4","etc":"배터리"},{"car":"TZ0214","lock":"잠김","fuel":15,"lock_fuel":95,"lat":"35.15428648388252","lng":"129.05575539257265","lastest":45143.37347222222,"address":"대한민국 부산광역시 부산진구 부전동 524-35","etc":"배터리"},{"car":"TZ0366","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.166619308889196","lng":"129.13413870458385","lastest":45143.37357638889,"address":"대한민국 부산광역시 해운대구 센텀3로 32","etc":"배터리"},{"car":"TZ0387","lock":"잠김","fuel":15,"lock_fuel":97,"lat":"35.136838279335365","lng":"129.06939927957788","lastest":45143.3714699074,"address":"대한민국 부산광역시 남구 문현동 680-9","etc":"배터리"},{"car":"TZ0404","lock":"잠김","fuel":15,"lock_fuel":95,"lat":"35.131436028627235","lng":"129.09851732663324","lastest":45143.37567129629,"address":"대한민국 부산광역시 남구 용소로64번길 49-1","etc":"배터리"},{"car":"TZ0099","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.140370663743845","lng":"129.11183709732347","lastest":45143.37453703704,"address":"대한민국 부산광역시 수영구 수영로408번길 65","etc":"배터리"},{"car":"TZ0118","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.165640357444914","lng":"129.15888775912057","lastest":45143.37212962963,"address":"대한민국 부산광역시 해운대구 우동1로38번길 20","etc":"배터리"},{"car":"TZ0146","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.165500094484834","lng":"129.1691786762396","lastest":45143.37284722222,"address":"대한민국 부산광역시 해운대구 좌동순환로 500","etc":"배터리"},{"car":"TZ0187","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.168088258810386","lng":"129.13954598847843","lastest":45143.37144675926,"address":"대한민국 부산광역시 해운대구 우동 1086-8","etc":"배터리"},{"car":"TZ0252","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.16812336193458","lng":"129.1395264785187","lastest":45143.3725462963,"address":"대한민국 부산광역시 해운대구 우동 1086-8","etc":"배터리"},{"car":"TZ0365","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.15992468008254","lng":"129.0648839093743","lastest":45143.37091435185,"address":"대한민국 부산광역시 부산진구 전포동 638-7","etc":"배터리"},{"car":"TZ0429","lock":"잠김","fuel":16,"lock_fuel":95,"lat":"35.154037044530064","lng":"129.0567187981835","lastest":45143.37328703704,"address":"대한민국 부산광역시 부산진구 부전동 524-46","etc":"배터리"},{"car":"TZ0435","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.135042964460986","lng":"129.0920078837861","lastest":45143.37394675926,"address":"대한민국 부산광역시 남구 대연제5동 대연","etc":"배터리"},{"car":"TZ0462","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.13595628639678","lng":"129.0963551319176","lastest":45143.37582175926,"address":"대한민국 부산광역시 남구 대연동 383-10","etc":"배터리"},{"car":"TZ0468","lock":"잠김","fuel":16,"lock_fuel":96,"lat":"35.155650550465296","lng":"129.1234570359812","lastest":45143.37258101852,"address":"대한민국 부산광역시 수영구 민락동 201-4","etc":"배터리"},{"car":"TZ0497","lock":"잠김","fuel":16,"lock_fuel":97,"lat":"35.136774927850695","lng":"129.09850950232178","lastest":45143.3711574074,"address":"대한민국 부산광역시 남구 대연동 407-10","etc":"배터리"}]
    


    // 주소 복사
    function copyToClipboard(val) {
        const t = document.createElement("textarea");
        document.body.appendChild(t);
        t.value = val;
        t.select();
        document.execCommand('copy');
        document.body.removeChild(t);
    }

    function copy(addr, carnum) {

        var jsonIdx = tourzy_bike.findIndex(function(key) {return key["car"] === carnum});
        
        var idx = JSON.stringify(jsonIdx);

        // console.log('idx : ' + idx)

        const onlongclick = ($target, duration, callback) => {

            $target.onmousedown = () => {
                const timer = setTimeout(callback, duration);

                $target.onmouseup = () => {
                clearTimeout(timer);
                };
            };  

            $target.ontouchstart = () => {
                const timer = setTimeout(callback, duration);

                $target.ontouchend = () => {
                clearTimeout(timer);
                };
            };  
        }

        // 코드예시
        const $target = document.querySelector('#html');

        onlongclick($target, 300, () => {

            alert('차량 번호 : ' + carnum + ' 작업을 완료했습니다.');
        });
        
        copyToClipboard(addr);

        $("#copied").show();

        self.setTimeout("hideDiv()", 2000);
    }
    
    $(document).ready(function () {

        $("#copied").hide();
    });
    // 주소 복사

    function hideDiv () {
        
        $("#copied").hide();
    }

    function mapLoad () {
        
        // $("#folium-map").html(JSON.stringify(XLSX.utils.sheet_to_json (sheet)));

        // console.log(JSON.stringify(XLSX.utils.sheet_to_json(sheet)))

        map = L.map("map", {
            center: [35.16380454089401, 129.1326448135078],
            crs: L.CRS.EPSG3857,
            zoom: 11,
            zoomControl: true,
            preferCanvas: false,
        });

        tile_layer = L.tileLayer(
            "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            {"attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
        ).addTo(map);

        for (let i = 0; i < tourzy_bike.length; i++) {

            // console.log(`${i} car:${tourzy_bike[i].car}, lat:${tourzy_bike[i].lat}, lng:${tourzy_bike[i].lng}`)

            // 시작
            marker = L.marker(
                [tourzy_bike[i].lat, tourzy_bike[i].lng],
                {}
            ).addTo(map);

            var icon_color = ''
            var icon_img = ''

            if (tourzy_bike[i].fuel <= 10) {

                icon_color = 'red'

            } else {

                icon_color = 'orange'
            }

            if (tourzy_bike[i].lock == '열림') {

                icon_img = 'ban-circle'

            } else {

                if (tourzy_bike[i].etc == 'GPS' || tourzy_bike[i].etc == '파손' || tourzy_bike[i].etc == '회수' || tourzy_bike[i].etc == '라이트') {

                    icon_img = 'plus-sign'

                } else if (tourzy_bike[i].etc == '이탈' || tourzy_bike[i].etc == '재배치') {

                    icon_img = 'refresh'
                    
                } else {

                    icon_img = 'flash'
                }
            }
        
            icon = L.AwesomeMarkers.icon(
                {"extraClasses": "fa-rotate-0", "icon": icon_img, "iconColor": "white", "markerColor": icon_color, "prefix": "glyphicon"}
            );
            marker.setIcon(icon);
        
            popup = L.popup({"maxWidth": "100%"});
            html = $(`<div id="html" onclick="copy('${tourzy_bike[i].address.replace("대한민국 ", "")}', '${tourzy_bike[i].car}')"; style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].car}<br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].fuel}%</div><br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].etc}</div></div>`)[0];
            popup.setContent(html);
            
            marker.bindPopup(popup);
            // 끝
        }
    }

    window.onload = function () {
        
        mapLoad ()
    }

</script>

<body>

    <div id="copied">주소가 복사되었습니다.</div>

    <div id="updated">UPDATED 2023.08.05. 09:00 총 48대
        <br/>
        금지 - 잠금 열린 차량 (4대)
        <br/>
        플러스 - 회수 후 정비가 필요한 차량 (1대)
        <br/>
        리프레쉬 - 재배치가 필요한 차량 (0대)
        <br/>
        번개 - 배터리 부족 빨간색 10% 이하, 주황색 10% 이상 20% 이하 (43대)
    </div>
    
    <div class="folium-map" id="map"></div>
        
</body>

</html>