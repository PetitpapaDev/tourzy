<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    
    <style>html, body {width: 100%; height: 100%; margin: 0; padding: 0;}</style>
    <style>#map {position:absolute; top:0; bottom:0; right:0; left:0;}</style>

    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
            
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <style>
        #map {
            position: relative;
            width: 100.0%;
            height: 100.0%;
            left: 0.0%;
            top: 0.0%;
        }

        #updated {
            width: 100%;
            text-align: center;
            position: fixed;
            top: 0%;
            padding-top: 10px;
            padding-bottom: 10px;

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            color: #000000;
            background: #FF7500;

            z-index: 9999;
        }

        #copied {
            width: 300px;
            height: 50px;
            text-align: center;
            position: fixed;
            bottom: 10%;
            left: 50%;
            transform: translate(-50%, 0%);

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            line-height: 50px;
            color: #000000;
            background: #FF7500;
            border-radius: 10px;

            z-index: 9999;
        }
    </style>
        
</head>

<script>

    var map
    var tile_layer
    var marker
    var icon
    var popup
    var html

    var tourzy_bike = 



[{"car":"TZ0110","lock":"열림","fuel":100,"lock_fuel":98,"lat":"35.15525042046139","lng":"129.12444792943816","lastest":45139.375,"address":"대한민국 부산광역시 수영구 광안해변로278번길","etc":"확인필요"},{"car":"TZ0094","lock":"잠김","fuel":0,"lock_fuel":90,"lat":"35.13344993703601","lng":"129.0995392272369","lastest":45139.37246527777,"address":"대한민국 부산광역시 남구 용소로46번길 30","etc":"배터리"},{"car":"TZ0135","lock":"잠김","fuel":0,"lock_fuel":69,"lat":"35.1290950839678","lng":"129.11313277222666","lastest":45139.37346064814,"address":"대한민국 부산광역시 남구 용호동 176-30","etc":"배터리"},{"car":"TZ0354","lock":"잠김","fuel":0,"lock_fuel":53,"lat":"35.16153691448576","lng":"129.1553753995562","lastest":45139.37398148148,"address":"대한민국 부산광역시 해운대구 해운대로 584","etc":"배터리"},{"car":"TZ0027","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.176625562934575","lng":"129.07409981156238","lastest":45139.37297453704,"address":"대한민국 부산광역시 부산진구 양정동 126-2","etc":"배터리"},{"car":"TZ0218","lock":"잠김","fuel":10,"lock_fuel":98,"lat":"35.156379415284114","lng":"129.11916425880392","lastest":45139.37185185185,"address":"대한민국 부산광역시 수영구 민락동 701-9","etc":"배터리"},{"car":"TZ0380","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.14811180103681","lng":"129.1106854942035","lastest":45139.37012731482,"address":"대한민국 부산광역시 수영구 남천동 30-26","etc":"배터리"},{"car":"TZ0396","lock":"잠김","fuel":10,"lock_fuel":98,"lat":"35.15994508473062","lng":"129.15717843217888","lastest":45139.37207175926,"address":"대한민국 부산광역시 해운대구 우동 645-5","etc":"배터리"},{"car":"TZ0401","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.13981713589614","lng":"129.1166769073842","lastest":45139.37634259259,"address":"대한민국 부산광역시 수영구 남천동 148-81","etc":"배터리"},{"car":"TZ0463","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.194280663154565","lng":"129.0801806632779","lastest":45139.37538194445,"address":"대한민국 부산광역시 연제구 거제동 42-35","etc":"배터리"},{"car":"TZ0499","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.145171422905456","lng":"129.11060589866668","lastest":45139.3703587963,"address":"대한민국 부산광역시 수영구 남천동 27-20","etc":"배터리"},{"car":"TZ0307","lock":"잠김","fuel":11,"lock_fuel":98,"lat":"35.167694516292016","lng":"129.16241033639182","lastest":45139.37008101852,"address":"대한민국 부산광역시 해운대구 우동 198-14","etc":"배터리"},{"car":"TZ0440","lock":"잠김","fuel":11,"lock_fuel":96,"lat":"35.14906689343902","lng":"129.06525074455678","lastest":45139.371875,"address":"대한민국 부산광역시 남구 문현동 697-9","etc":"배터리"},{"car":"TZ0393","lock":"잠김","fuel":13,"lock_fuel":98,"lat":"35.140391928924224","lng":"129.10620955710934","lastest":45139.37118055556,"address":"대한민국 부산광역시 수영구 남천동 340-2","etc":"배터리"},{"car":"TZ0115","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.12410049235315","lng":"129.09936374009698","lastest":45139.37025462963,"address":"대한민국 부산광역시 남구 용당동 533-4","etc":"배터리"},{"car":"TZ0227","lock":"잠김","fuel":15,"lock_fuel":97,"lat":"35.14928966661342","lng":"129.1126215620669","lastest":45139.37396990741,"address":"대한민국 부산광역시 수영구 남천동 26-21번지","etc":"배터리"},{"car":"TZ0312","lock":"잠김","fuel":15,"lock_fuel":98,"lat":"35.166954191301166","lng":"129.12967848541277","lastest":45139.37303240741,"address":"대한민국 부산광역시 해운대구 우동 1291","etc":"배터리"},{"car":"TZ0114","lock":"잠김","fuel":16,"lock_fuel":97,"lat":"35.15087885766352","lng":"129.11393169518917","lastest":45139.37177083334,"address":"대한민국 부산광역시 수영구 수영로510번길 43 1층 101호","etc":"배터리"},{"car":"TZ0402","lock":"잠김","fuel":17,"lock_fuel":97,"lat":"35.158273015612835","lng":"129.11657110014153","lastest":45139.37399305555,"address":"대한민국 부산광역시 수영구 수영로594번길 58","etc":"배터리"},{"car":"TZ0107","lock":"잠김","fuel":18,"lock_fuel":97,"lat":"35.15951517553592","lng":"129.10893001003836","lastest":45139.36881944445,"address":"대한민국 부산광역시 수영구 광안제4동 736-59","etc":"배터리"},{"car":"TZ0138","lock":"잠김","fuel":18,"lock_fuel":97,"lat":"35.161402119925654","lng":"129.17390013623546","lastest":45139.36881944445,"address":"대한민국 부산광역시 해운대구 좌동순환로 427","etc":"배터리"},{"car":"TZ0206","lock":"잠김","fuel":18,"lock_fuel":95,"lat":"35.16878837990131","lng":"129.1827423771291","lastest":45139.36983796296,"address":"대한민국 부산광역시 해운대구 좌동순환로 304","etc":"배터리"},{"car":"TZ0250","lock":"잠김","fuel":18,"lock_fuel":96,"lat":"35.14755722979093","lng":"129.1103563032564","lastest":45139.37517361111,"address":"대한민국 부산광역시 금련산청소년수련원","etc":"배터리"},{"car":"TZ0061","lock":"잠김","fuel":19,"lock_fuel":95,"lat":"35.144724117370004","lng":"129.06243462665753","lastest":45139.37032407407,"address":"대한민국 부산광역시 부산진구 중앙번영로 30","etc":"배터리"},{"car":"TZ0126","lock":"잠김","fuel":19,"lock_fuel":97,"lat":"35.160399298568386","lng":"129.12977473392672","lastest":45139.37476851852,"address":"대한민국 부산광역시 수영구 민락동 108-4","etc":"배터리"},{"car":"TZ0165","lock":"잠김","fuel":19,"lock_fuel":97,"lat":"35.18990826073442","lng":"129.11633160861624","lastest":45139.36966435185,"address":"대한민국 부산광역시 해운대구 재송동 939-27","etc":"배터리"},{"car":"TZ0194","lock":"잠김","fuel":19,"lock_fuel":97,"lat":"35.161068809225036","lng":"129.13053865753636","lastest":45139.37144675926,"address":"대한민국 부산광역시 수영구 민락동 1-24","etc":"배터리"},{"car":"TZ0305","lock":"잠김","fuel":19,"lock_fuel":96,"lat":"35.179449146512376","lng":"129.1225675788852","lastest":45139.37076388889,"address":"대한민국 부산광역시 해운대구 센텀중앙로 142","etc":"배터리"},{"car":"TZ0336","lock":"잠김","fuel":19,"lock_fuel":97,"lat":"35.163903232222836","lng":"129.1836270560761","lastest":45139.374375,"address":"대한민국 부산광역시 해운대구 중동 1528-1","etc":"배터리"},{"car":"TZ0385","lock":"잠김","fuel":19,"lock_fuel":97,"lat":"35.14110792145478","lng":"129.10697768614403","lastest":45139.37055555556,"address":"대한민국 부산광역시 수영구 부산광역시 수영구 남천동 24-13 원탄크리닉 6층","etc":"배터리"},{"car":"TZ0021","lock":"잠김","fuel":20,"lock_fuel":96,"lat":"35.16106606397524","lng":"129.1431710418823","lastest":45139.37486111111,"address":"대한민국 부산광역시 해운대구 해운대해변로 99","etc":"배터리"},{"car":"TZ0070","lock":"잠김","fuel":20,"lock_fuel":97,"lat":"35.15394315843731","lng":"129.1276074352644","lastest":45139.36972222223,"address":"대한민국 부산광역시 수영구 민락동 113-41","etc":"배터리"},{"car":"TZ0116","lock":"잠김","fuel":20,"lock_fuel":96,"lat":"35.141979241265716","lng":"129.1106323510814","lastest":45139.36952546296,"address":"대한민국 부산광역시 수영구 남천동로22번길 6","etc":"배터리"},{"car":"TZ0203","lock":"잠김","fuel":20,"lock_fuel":96,"lat":"35.170311470342035","lng":"129.17815792886574","lastest":45139.37579861111,"address":"대한민국 부산광역시 해운대구 세실로 43 지하1층","etc":"배터리"},{"car":"TZ0245","lock":"잠김","fuel":20,"lock_fuel":97,"lat":"35.16590321305748","lng":"129.17838411892515","lastest":45139.37002314815,"address":"대한민국 부산광역시 현대아파트","etc":"배터리"},{"car":"TZ0292","lock":"잠김","fuel":20,"lock_fuel":97,"lat":"35.1726051757038","lng":"129.1794028583421","lastest":45139.37597222222,"address":"대한민국 부산광역시 해운대구 좌동 1308","etc":"배터리"},{"car":"TZ0137","lock":"잠김","fuel":21,"lock_fuel":97,"lat":"35.15592175941549","lng":"129.11370505010115","lastest":45139.36868055556,"address":"대한민국 부산광역시 수영구 광안동 509-111","etc":"배터리"},{"car":"TZ0261","lock":"잠김","fuel":21,"lock_fuel":96,"lat":"35.13526888286086","lng":"129.09421033903553","lastest":45139.37082175926,"address":"대한민국 부산광역시 남구 대연동 330-3","etc":"배터리"},{"car":"TZ0297","lock":"잠김","fuel":21,"lock_fuel":96,"lat":"35.1872257155796","lng":"129.10520290688413","lastest":45139.37010416666,"address":"대한민국 부산광역시 연산동 414-46번지 1호 연제구 부산광역시 KR","etc":"배터리"},{"car":"TZ0379","lock":"잠김","fuel":21,"lock_fuel":97,"lat":"35.14707532733437","lng":"129.11414427529377","lastest":45139.37328703704,"address":"대한민국 부산광역시 수영구 남천동 5-30","etc":"배터리"},{"car":"TZ0219","lock":"잠김","fuel":100,"lock_fuel":98,"lat":"35.16012015876625","lng":"129.11471976439645","lastest":45139.37421296296,"address":"대한민국 부산광역시 광안동 120-269번지 수영구 부산광역시 KR","etc":"파손"},{"car":"TZ0191","lock":"잠김","fuel":12,"lock_fuel":96,"lat":"35.15144330184097","lng":"129.11638480644888","lastest":45139.37247685185,"address":"대한민국 부산광역시 수영구 광안동 197-2","etc":"라이트"},{"car":"TZ0051","lock":"잠김","fuel":20,"lock_fuel":98,"lat":"35.160618585142096","lng":"129.16129948495626","lastest":45139.36858796296,"address":"대한민국 부산광역시 해운대구 중동 1391-3","etc":"라이트"},{"car":"TZ0358","lock":"잠김","fuel":23,"lock_fuel":97,"lat":"35.17079852633981","lng":"129.17704366611179","lastest":45139.3728587963,"address":"대한민국 부산광역시 해운대구 좌동 1467-4","etc":"라이트"},{"car":"TZ0239","lock":"잠김","fuel":27,"lock_fuel":97,"lat":"35.16384716639607","lng":"129.16926479435077","lastest":45139.37518518518,"address":"대한민국 부산광역시 해운대구 중동 1774-5번지","etc":"라이트"},{"car":"TZ0399","lock":"잠김","fuel":28,"lock_fuel":97,"lat":"35.15041933237181","lng":"129.0664709861896","lastest":45139.3734837963,"address":"대한민국 부산광역시 부산진구 전포대로 156","etc":"라이트"},{"car":"TZ0092","lock":"잠김","fuel":77,"lock_fuel":98,"lat":"35.13077552700987","lng":"129.10632531209265","lastest":45139.36951388889,"address":"대한민국 부산광역시 남구 대연동 1844-3","etc":"라이트"},{"car":"TZ0068","lock":"잠김","fuel":100,"lock_fuel":98,"lat":"35.16278099952488","lng":"129.1457235388379","lastest":45139.36935185185,"address":"대한민국 부산광역시 해운대구 우동 983-4","etc":"라이트"},{"car":"TZ0181","lock":"잠김","fuel":100,"lock_fuel":99,"lat":"35.13484305317092","lng":"129.1122121276793","lastest":45139.36990740741,"address":"2층, W스퀘어 954번지 용호동 남구 부산광역시 대한민국","etc":"라이트"},{"car":"TZ0244","lock":"잠김","fuel":86,"lock_fuel":98,"lat":"35.19329866473665","lng":"129.2123407265709","lastest":45139.37578703704,"address":"대한민국 부산광역시 기장군 당사리 64 (기장해안로 147)","etc":"라이트"}]




    // 주소 복사
    function copyToClipboard(val) {
        const t = document.createElement("textarea");
        document.body.appendChild(t);
        t.value = val;
        t.select();
        document.execCommand('copy');
        document.body.removeChild(t);
    }

    function copy(addr, carnum) {

        var jsonIdx = tourzy_bike.findIndex(function(key) {return key["car"] === carnum});
        
        var idx = JSON.stringify(jsonIdx);

        // console.log('idx : ' + idx)

        const onlongclick = ($target, duration, callback) => {

            $target.onmousedown = () => {
                const timer = setTimeout(callback, duration);

                $target.onmouseup = () => {
                clearTimeout(timer);
                };
            };  

            $target.ontouchstart = () => {
                const timer = setTimeout(callback, duration);

                $target.ontouchend = () => {
                clearTimeout(timer);
                };
            };  
        }

        // 코드예시
        const $target = document.querySelector('#html');

        onlongclick($target, 300, () => {

            alert('차량 번호 : ' + carnum + ' 작업을 완료했습니다.');
        });
        
        copyToClipboard(addr);

        $("#copied").show();

        self.setTimeout("hideDiv()", 2000);
    }
    
    $(document).ready(function () {

        $("#copied").hide();
    });
    // 주소 복사

    function hideDiv () {
        
        $("#copied").hide();
    }

    function mapLoad () {
        
        // $("#folium-map").html(JSON.stringify(XLSX.utils.sheet_to_json (sheet)));

        // console.log(JSON.stringify(XLSX.utils.sheet_to_json(sheet)))

        map = L.map("map", {
            center: [35.16380454089401, 129.1326448135078],
            crs: L.CRS.EPSG3857,
            zoom: 11,
            zoomControl: true,
            preferCanvas: false,
        });

        tile_layer = L.tileLayer(
            "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            {"attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
        ).addTo(map);

        for (let i = 0; i < tourzy_bike.length; i++) {

            // console.log(`${i} car:${tourzy_bike[i].car}, lat:${tourzy_bike[i].lat}, lng:${tourzy_bike[i].lng}`)

            // 시작
            marker = L.marker(
                [tourzy_bike[i].lat, tourzy_bike[i].lng],
                {}
            ).addTo(map);

            var icon_color = ''
            var icon_img = ''

            if (tourzy_bike[i].fuel < 15) {

                icon_color = 'red'

            } else {

                icon_color = 'orange'
            }

            if (tourzy_bike[i].lock == '열림') {

                icon_img = 'ban-circle'

            } else {

                if (tourzy_bike[i].etc == 'GPS' || tourzy_bike[i].etc == '파손' || tourzy_bike[i].etc == '회수' || tourzy_bike[i].etc == '라이트') {

                    icon_img = 'plus-sign'

                } else if (tourzy_bike[i].etc == '이탈') {

                    icon_img = 'refresh'
                    
                } else {

                    icon_img = 'flash'
                }
            }
        
            icon = L.AwesomeMarkers.icon(
                {"extraClasses": "fa-rotate-0", "icon": icon_img, "iconColor": "white", "markerColor": icon_color, "prefix": "glyphicon"}
            );
            marker.setIcon(icon);
        
            popup = L.popup({"maxWidth": "100%"});
            html = $(`<div id="html" onclick="copy('${tourzy_bike[i].address.replace("대한민국 ", "")}', '${tourzy_bike[i].car}')"; style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].car}<br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].fuel}%</div><br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].etc}</div></div>`)[0];
            popup.setContent(html);
            
            marker.bindPopup(popup);
            // 끝
        }
    }

    window.onload = function () {
        
        mapLoad ()
    }

</script>

<body>

    <div id="copied">주소가 복사되었습니다.</div>

    <div id="updated">UPDATED 2023.08.01. 09:00 총 50대
        <br/>
        밴 - 잠금 열린 차량 (1대)
        <br/>
        플러스 - 회수 후 정비가 필요한 차량 (10대)
        <br/>
        리프레쉬 - 재배치가 필요한 차량 (0대)
        <br/>
        번개 - 배터리 부족 빨간색 15% 이하, 주황색 15% 이상 30% 이하 (39대)
    </div>
    
    <div class="folium-map" id="map"></div>
        
</body>

</html>