<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    
    <style>html, body {width: 100%; height: 100%; margin: 0; padding: 0;}</style>
    <style>#map {position:absolute; top:0; bottom:0; right:0; left:0;}</style>

    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
            
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <style>
        #map {
            position: relative;
            width: 100.0%;
            height: 100.0%;
            left: 0.0%;
            top: 0.0%;
        }

        #updated {
            width: 100%;
            text-align: center;
            position: fixed;
            top: 0%;
            padding-top: 10px;
            padding-bottom: 10px;

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            color: #000000;
            background: #FF7500;

            z-index: 9999;
        }

        #copied {
            width: 300px;
            height: 50px;
            text-align: center;
            position: fixed;
            bottom: 10%;
            left: 50%;
            transform: translate(-50%, 0%);

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            line-height: 50px;
            color: #000000;
            background: #FF7500;
            border-radius: 10px;

            z-index: 9999;
        }
    </style>
        
</head>

<script>

    var map
    var tile_layer
    var marker
    var icon
    var popup
    var html

    var tourzy_bike = 



        [{"car":"TZ0179","lock":"잠김","fuel":36,"lock_fuel":97,"lat":35.1423975,"lng":129.1015055,"lastest":45133.31429398148,"address":"대한민국 부산광역시 남구 수영로 345 대연힐스테이트 푸르지오 101동 지하2층 주차장 5, 6라인","etc":"GPS"},{"car":"TZ0277","lock":"잠김","fuel":45,"lock_fuel":97,"lat":35.1615746,"lng":129.1638936,"lastest":45133.318877314814,"address":"대한민국 부산광역시 해운대구 해운대해변로 305","etc":"GPS"},{"car":"TZ0331","lock":"잠김","fuel":48,"lock_fuel":96,"lat":35.1272836,"lng":129.1089732,"lastest":45133.31980324074,"address":"대한민국 부산광역시 남구 분포로 113 홈플러스익스프레스 메트로시티점","etc":"GPS"},{"car":"TZ0452","lock":"잠김","fuel":0,"lock_fuel":98,"lat":"35.231275418164984","lng":"129.08463859365156","lastest":45134.38533564815,"address":"대한민국 부산광역시 금정구 장전동 399-9","etc":"회수"},{"car":"TZ0081","lock":"잠김","fuel":10,"lock_fuel":98,"lat":"35.15874776421379","lng":"129.05502987653637","lastest":45134.38502314815,"address":"대한민국 부산광역시 부산진구 부전제1동 469-16","etc":"회수"},{"car":"TZ0233","lock":"잠김","fuel":10,"lock_fuel":98,"lat":35.1267440999015,"lng":129.108950330597,"lastest":45133.7143287037,"address":"대한민국 부산광역시 남구 용호동 173-20","etc":"회수"},{"car":"TZ0004","lock":"잠김","fuel":34,"lock_fuel":96,"lat":35.1463525852463,"lng":129.066590510002,"lastest":45133.717453703706,"address":"대한민국 부산광역시 남구 전포대로 지하 97","etc":"파손"},{"car":"TZ0166","lock":"잠김","fuel":51,"lock_fuel":95,"lat":"35.20144051543201","lng":"129.0740673528816","lastest":45134.3834375,"address":"대한민국 부산광역시 동래구 여고로113번길 69-2","etc":"이탈"},{"car":"TZ0394","lock":"잠김","fuel":44,"lock_fuel":97,"lat":"35.210820429042904","lng":"129.07929384561044","lastest":45134.38708333333,"address":"대한민국 부산광역시 동래구 명륜동 661-11","etc":"이탈"},{"car":"TZ0395","lock":"잠김","fuel":27,"lock_fuel":96,"lat":"35.21185148321876","lng":"129.07937994778257","lastest":45134.38564814815,"address":"대한민국 부산광역시 동래구 중앙대로 1414","etc":"이탈"},{"car":"TZ0063","lock":"잠김","fuel":0,"lock_fuel":90,"lat":"35.18914291868257","lng":"129.0742614285469","lastest":45135.37145833333,"address":"대한민국 부산광역시 연제구 거제동 422-17","etc":"배터리"},{"car":"TZ0209","lock":"잠김","fuel":0,"lock_fuel":90,"lat":"35.16357904078959","lng":"129.14216448709902","lastest":45135.3744212963,"address":"대한민국 부산광역시 해운대구 우동 1193-1","etc":"배터리"},{"car":"TZ0212","lock":"잠김","fuel":0,"lock_fuel":74,"lat":"35.1819750978485","lng":"129.12330026239366","lastest":45135.37052083333,"address":"대한민국 부산광역시 해운대구 재송동 369-5","etc":"배터리"},{"car":"TZ0235","lock":"잠김","fuel":0,"lock_fuel":28,"lat":"35.16418663387317","lng":"129.06538625460777","lastest":45135.37405092592,"address":"대한민국 부산광역시 부산진구 전포대로300번길 3","etc":"배터리"},{"car":"TZ0266","lock":"잠김","fuel":0,"lock_fuel":95,"lat":"35.16659751599531","lng":"129.11639091542696","lastest":45135.37496527778,"address":"대한민국 부산광역시 수영구 광안동 75-6","etc":"배터리"},{"car":"TZ0285","lock":"잠김","fuel":0,"lock_fuel":92,"lat":"35.144402176204295","lng":"129.10928629322117","lastest":45135.37423611111,"address":"대한민국 부산광역시 수영구 남천동 69-48","etc":"배터리"},{"car":"TZ0317","lock":"잠김","fuel":0,"lock_fuel":91,"lat":"35.14934526211496","lng":"129.11515494824974","lastest":45135.37181712963,"address":"대한민국 부산광역시 수영구 광안동 201-21","etc":"배터리"},{"car":"TZ0354","lock":"잠김","fuel":0,"lock_fuel":89,"lat":"35.16154063645397","lng":"129.15549705461757","lastest":45135.37471064815,"address":"대한민국 부산광역시 해운대구 해운대로 584","etc":"배터리"},{"car":"TZ0396","lock":"잠김","fuel":0,"lock_fuel":79,"lat":"35.22718390940032","lng":"129.0832042649947","lastest":45135.3741087963,"address":"대한민국 부산광역시 금정구 장전동 538-18","etc":"배터리"},{"car":"TZ0427","lock":"잠김","fuel":0,"lock_fuel":88,"lat":"35.148585377259636","lng":"129.06621938261065","lastest":45135.37364583334,"address":"대한민국 부산광역시 부산진구 전포동 374-31","etc":"배터리"},{"car":"TZ0496","lock":"잠김","fuel":0,"lock_fuel":92,"lat":"35.156989553273625","lng":"129.12726058922172","lastest":45135.37511574074,"address":"대한민국 부산광역시 수영구 민락동 113-19","etc":"배터리"},{"car":"TZ0056","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.15425281736285","lng":"129.14609816975025","lastest":45135.37137731481,"address":"대한민국 부산광역시 해운대구 우동 1436-1","etc":"배터리"},{"car":"TZ0140","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.14644568400876","lng":"129.1118248751144","lastest":45135.37006944444,"address":"대한민국 부산광역시 수영구 남천동 7-14","etc":"배터리"},{"car":"TZ0144","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.149591622339855","lng":"129.1145119586014","lastest":45135.37118055556,"address":"대한민국 부산광역시 수영구 광안동 202-12","etc":"배터리"},{"car":"TZ0159","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.15708127846265","lng":"129.05345202772435","lastest":45135.36984953703,"address":"대한민국 부산광역시 부산진구 부전동 508-40","etc":"배터리"},{"car":"TZ0185","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.1555056362942","lng":"129.12184674367026","lastest":45135.37540509259,"address":"대한민국 부산광역시 수영구 민락동 177-3","etc":"배터리"},{"car":"TZ0202","lock":"잠김","fuel":10,"lock_fuel":95,"lat":"35.15412058550442","lng":"129.14492694380152","lastest":45135.3700462963,"address":"대한민국 부산광역시 해운대구 우동 1410-3","etc":"배터리"},{"car":"TZ0225","lock":"잠김","fuel":10,"lock_fuel":98,"lat":"35.15701423050974","lng":"129.12779798985832","lastest":45135.37118055556,"address":"대한민국 부산광역시 수영구 민락수변로","etc":"배터리"},{"car":"TZ0268","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.173629784958464","lng":"129.16722537224084","lastest":45135.37203703704,"address":"대한민국 부산광역시 해운대구 좌동순환로 79","etc":"배터리"},{"car":"TZ0282","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.17408372364546","lng":"129.12003531642273","lastest":45135.37112268519,"address":"대한민국 부산광역시 수영구 망미동 238-5","etc":"배터리"},{"car":"TZ0284","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.139079834321656","lng":"129.1147097128527","lastest":45135.37606481482,"address":"대한민국 부산광역시 수영구 남천동 554-2","etc":"배터리"},{"car":"TZ0308","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.15597948250295","lng":"129.12277188418125","lastest":45135.37195601852,"address":"대한민국 부산광역시 수영구 민락동 218-2","etc":"배터리"},{"car":"TZ0313","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.15555442557873","lng":"129.12342797099927","lastest":45135.36960648148,"address":"대한민국 부산광역시 수영구 민락동 201-4","etc":"배터리"},{"car":"TZ0319","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.13147869346203","lng":"129.10413914960694","lastest":45135.37399305555,"address":"대한민국 부산광역시 남구 대연동 604-5","etc":"배터리"},{"car":"TZ0329","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.14841292606103","lng":"129.1144733027956","lastest":45135.37416666667,"address":"대한민국 부산광역시 수영구 광안제2동 광안해변로 153-1","etc":"배터리"},{"car":"TZ0356","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.16052959505997","lng":"129.1533106911168","lastest":45135.37045138889,"address":"대한민국 부산광역시 해운대구 우동 840-4","etc":"배터리"},{"car":"TZ0003","lock":"잠김","fuel":11,"lock_fuel":96,"lat":"35.181429184360184","lng":"129.06972240363416","lastest":45135.37202546297,"address":"대한민국 부산광역시 연제구 거제동 608-19","etc":"배터리"},{"car":"TZ0083","lock":"잠김","fuel":11,"lock_fuel":95,"lat":"35.229775053861886","lng":"129.08923890194427","lastest":45135.37305555555,"address":"대한민국 부산광역시 금정구 장전온천천로 48 부산대역","etc":"배터리"},{"car":"TZ0347","lock":"잠김","fuel":11,"lock_fuel":97,"lat":"35.158641265132246","lng":"129.11320599200369","lastest":45135.37390046296,"address":"대한민국 부산광역시 수영구 광안동 741-1","etc":"배터리"},{"car":"TZ0238","lock":"잠김","fuel":13,"lock_fuel":97,"lat":"35.193481594520776","lng":"129.11761001584028","lastest":45135.37414351852,"address":"대한민국 부산광역시 해운대구 반여동 1476-4","etc":"배터리"},{"car":"TZ0339","lock":"잠김","fuel":13,"lock_fuel":98,"lat":"35.15627736478649","lng":"129.11638669412062","lastest":45135.37291666667,"address":"대한민국 부산광역시 수영구 광안동 150-68번지","etc":"배터리"},{"car":"TZ0500","lock":"잠김","fuel":13,"lock_fuel":97,"lat":"35.16161954745973","lng":"129.06278325585347","lastest":45135.37384259259,"address":"대한민국 부산광역시 부산진구 동성로 152","etc":"배터리"},{"car":"TZ0345","lock":"잠김","fuel":14,"lock_fuel":97,"lat":"35.22993980510063","lng":"129.08925592067186","lastest":45135.37361111111,"address":"대한민국 부산광역시 금정구 장전동 643-72","etc":"배터리"},{"car":"TZ0494","lock":"잠김","fuel":14,"lock_fuel":97,"lat":"35.180211557034035","lng":"129.0771332658387","lastest":45135.37542824074,"address":"대한민국 부산광역시 연제구 연산동 1363-8","etc":"배터리"},{"car":"TZ0205","lock":"잠김","fuel":16,"lock_fuel":98,"lat":"35.16762121709599","lng":"129.1163992660711","lastest":45135.37241898148,"address":"대한민국 부산광역시 수영구 광안동 50-7","etc":"배터리"},{"car":"TZ0295","lock":"잠김","fuel":16,"lock_fuel":97,"lat":"35.12519196325266","lng":"129.11256000756407","lastest":45135.37131944444,"address":"대한민국 부산광역시 남구 용호동 176-71","etc":"배터리"},{"car":"TZ0306","lock":"잠김","fuel":16,"lock_fuel":97,"lat":"35.178881483656866","lng":"129.1750860219523","lastest":45135.36934027778,"address":"대한민국 부산광역시 해운대구 좌동 1396","etc":"배터리"},{"car":"TZ0054","lock":"잠김","fuel":17,"lock_fuel":97,"lat":"35.17588998579442","lng":"129.1766024728436","lastest":45135.37362268518,"address":"대한민국 부산광역시 해운대구 좌동 1298","etc":"배터리"},{"car":"TZ0351","lock":"잠김","fuel":17,"lock_fuel":97,"lat":"35.19009998778017","lng":"129.11798348048245","lastest":45135.36659722222,"address":"대한민국 부산광역시 재송동 948-12번지 4층 해운대구 부산광역시 KR","etc":"배터리"},{"car":"TZ0409","lock":"잠김","fuel":17,"lock_fuel":97,"lat":"35.194900138046954","lng":"129.20867940047552","lastest":45135.375625,"address":"대한민국 부산광역시 기장군 기장읍 당사리 521","etc":"배터리"},{"car":"TZ0450","lock":"잠김","fuel":17,"lock_fuel":97,"lat":"35.15639907383178","lng":"129.12123780422138","lastest":45135.37319444444,"address":"대한민국 부산광역시 민락동 174-14번지 수영구 부산광역시 KR","etc":"배터리"},{"car":"TZ0080","lock":"잠김","fuel":18,"lock_fuel":98,"lat":"35.1629210461784","lng":"129.15741444354148","lastest":45135.37175925926,"address":"대한민국 부산광역시 해운대구 우제1동 537-3","etc":"배터리"},{"car":"TZ0208","lock":"잠김","fuel":18,"lock_fuel":97,"lat":"35.16421198707506","lng":"129.15828302249585","lastest":45135.37203703704,"address":"대한민국 부산광역시 해운대구 우동 532-31","etc":"배터리"},{"car":"TZ0217","lock":"잠김","fuel":18,"lock_fuel":97,"lat":"35.1750377801918","lng":"129.16823503047263","lastest":45135.3706712963,"address":"대한민국 부산광역시 대림3차아파트","etc":"배터리"},{"car":"TZ0222","lock":"잠김","fuel":18,"lock_fuel":96,"lat":"35.161100997617275","lng":"129.17122553022034","lastest":45135.37525462963,"address":"대한민국 부산광역시 해운대구 달맞이길62번길 2","etc":"배터리"},{"car":"TZ0258","lock":"잠김","fuel":18,"lock_fuel":97,"lat":"35.15421525684017","lng":"129.1261478342717","lastest":45135.375625,"address":"대한민국 부산광역시 수영구 민락동 181-88","etc":"배터리"},{"car":"TZ0320","lock":"잠김","fuel":18,"lock_fuel":97,"lat":"35.15709058334347","lng":"129.11369285306841","lastest":45135.37283564815,"address":"대한민국 부산광역시 수영구 광안동 475-4","etc":"배터리"},{"car":"TZ0340","lock":"잠김","fuel":18,"lock_fuel":97,"lat":"35.17591423674354","lng":"129.1226169791611","lastest":45135.37568287037,"address":"대한민국 부산광역시 해운대구 재송동 607-3","etc":"배터리"},{"car":"TZ0363","lock":"잠김","fuel":18,"lock_fuel":96,"lat":"35.2312498613833","lng":"129.08016791671992","lastest":45135.37322916667,"address":"대한민국 부산광역시 금정구 부산대학로63번길","etc":"배터리"},{"car":"TZ0436","lock":"잠김","fuel":18,"lock_fuel":96,"lat":"35.12656320836309","lng":"129.10796742870244","lastest":45135.37611111111,"address":"대한민국 부산광역시 남구 용호동 179-7","etc":"배터리"},{"car":"TZ0479","lock":"잠김","fuel":18,"lock_fuel":97,"lat":"35.181408668682806","lng":"129.06934389175188","lastest":45135.37113425926,"address":"대한민국 부산광역시 연제구 거제동 670-18","etc":"배터리"}]
    


    // 주소 복사
    function copyToClipboard(val) {
        const t = document.createElement("textarea");
        document.body.appendChild(t);
        t.value = val;
        t.select();
        document.execCommand('copy');
        document.body.removeChild(t);
    }

    function copy(addr, carnum) {

        var jsonIdx = tourzy_bike.findIndex(function(key) {return key["car"] === carnum});
        
        var idx = JSON.stringify(jsonIdx);

        // console.log('idx : ' + idx)

        const onlongclick = ($target, duration, callback) => {

            $target.onmousedown = () => {
                const timer = setTimeout(callback, duration);

                $target.onmouseup = () => {
                clearTimeout(timer);
                };
            };  

            $target.ontouchstart = () => {
                const timer = setTimeout(callback, duration);

                $target.ontouchend = () => {
                clearTimeout(timer);
                };
            };  
        }

        // 코드예시
        const $target = document.querySelector('#html');

        onlongclick($target, 300, () => {

            alert('차량 번호 : ' + carnum + ' 작업을 완료했습니다.');
        });
        
        copyToClipboard(addr);

        $("#copied").show();

        self.setTimeout("hideDiv()", 2000);
    }
    
    $(document).ready(function () {

        $("#copied").hide();
    });
    // 주소 복사

    function hideDiv () {
        
        $("#copied").hide();
    }

    function mapLoad () {
        
        // $("#folium-map").html(JSON.stringify(XLSX.utils.sheet_to_json (sheet)));

        // console.log(JSON.stringify(XLSX.utils.sheet_to_json(sheet)))

        map = L.map("map", {
            center: [35.16380454089401, 129.1326448135078],
            crs: L.CRS.EPSG3857,
            zoom: 11,
            zoomControl: true,
            preferCanvas: false,
        });

        tile_layer = L.tileLayer(
            "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            {"attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
        ).addTo(map);

        for (let i = 0; i < tourzy_bike.length; i++) {

            // console.log(`${i} car:${tourzy_bike[i].car}, lat:${tourzy_bike[i].lat}, lng:${tourzy_bike[i].lng}`)

            // 시작
            marker = L.marker(
                [tourzy_bike[i].lat, tourzy_bike[i].lng],
                {}
            ).addTo(map);

            var icon_color = ''
            var icon_img = ''

            if (tourzy_bike[i].fuel < 15) {

                icon_color = 'red'

            } else {

                icon_color = 'orange'
            }

            if (tourzy_bike[i].lock == '열림') {

                icon_img = 'ban-circle'

            } else {

                if (tourzy_bike[i].etc == 'GPS' || tourzy_bike[i].etc == '파손' || tourzy_bike[i].etc == '회수') {

                    icon_img = 'plus-sign'

                } else if (tourzy_bike[i].etc == '이탈') {

                    icon_img = 'refresh'
                    
                } else {

                    icon_img = 'flash'
                }
            }
        
            icon = L.AwesomeMarkers.icon(
                {"extraClasses": "fa-rotate-0", "icon": icon_img, "iconColor": "white", "markerColor": icon_color, "prefix": "glyphicon"}
            );
            marker.setIcon(icon);
        
            popup = L.popup({"maxWidth": "100%"});
            html = $(`<div id="html" onclick="copy('${tourzy_bike[i].address.replace("대한민국 ", "")}', '${tourzy_bike[i].car}')"; style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].car}<br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].fuel}%</div><br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].etc}</div></div>`)[0];
            popup.setContent(html);
            
            marker.bindPopup(popup);
            // 끝
        }
    }

    window.onload = function () {
        
        mapLoad ()
    }

</script>

<body>

    <div id="copied">주소가 복사되었습니다.</div>

    <div id="updated">UPDATED 2023.07.28. 09:00 총 61대
        <br/>
        밴 - 잠금 열린 차량 (0대)
        <br/>
        플러스 - 회수 후 정비가 필요한 차량 (7대)
        <br/>
        리프레쉬 - 재배치가 필요한 차량 (3대)
        <br/>
        번개 - 배터리 부족 빨간색 15% 이하, 주황색 15% 이상 30% 이하 (51대)
    </div>
    
    <div class="folium-map" id="map"></div>
        
</body>

</html>