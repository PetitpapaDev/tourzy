<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    
    <style>html, body {width: 100%; height: 100%; margin: 0; padding: 0;}</style>
    <style>#map {position:absolute; top:0; bottom:0; right:0; left:0;}</style>

    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
            
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <style>
        #map {
            position: relative;
            width: 100.0%;
            height: 100.0%;
            left: 0.0%;
            top: 0.0%;
        }

        #updated {
            width: 100%;
            text-align: center;
            position: fixed;
            top: 0%;
            padding-top: 10px;
            padding-bottom: 10px;

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            color: #000000;
            background: #FF7500;

            z-index: 9999;
        }

        #copied {
            width: 300px;
            height: 50px;
            text-align: center;
            position: fixed;
            bottom: 10%;
            left: 50%;
            transform: translate(-50%, 0%);

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            line-height: 50px;
            color: #000000;
            background: #FF7500;
            border-radius: 10px;

            z-index: 9999;
        }
    </style>
        
</head>

<script>

    var map
    var tile_layer
    var marker
    var icon
    var popup
    var html

    var tourzy_bike = 



[{"car":"TZ0354","lock":"잠김","fuel":0,"lock_fuel":17,"lat":"35.16334607312817","lng":"129.13652022005869","lastest":45141.66605324074,"address":"대한민국 부산광역시 해강중고교","etc":"회수"},{"car":"TZ0174","lock":"잠김","fuel":90,"lock_fuel":98,"lat":"35.13512011558629","lng":"129.10099944459196","lastest":45141.66549768519,"address":"대한민국 부산광역시 남구 대연동 427-15","etc":"회수"},{"car":"TZ0282","lock":"잠김","fuel":88,"lock_fuel":98,"lat":"35.15556810161648","lng":"129.12394148858664","lastest":45141.66633101852,"address":"대한민국 부산광역시 수영구 민락동 181-205","etc":"회수"},{"car":"TZ0219","lock":"잠김","fuel":94,"lock_fuel":98,"lat":"35.160135772715755","lng":"129.11469983954288","lastest":45141.66358796296,"address":"대한민국 부산광역시 광안동 120-269번지 수영구 부산광역시 KR","etc":"회수"},{"car":"TZ0479","lock":"열림","fuel":81,"lock_fuel":98,"lat":"35.15819892666119","lng":"129.11312565012832","lastest":45142.37627314815,"address":"대한민국 부산광역시 수영구 수영로 587","etc":"미잠금"},{"car":"TZ0046","lock":"열림","fuel":41,"lock_fuel":98,"lat":"35.161620244579716","lng":"129.1596931572966","lastest":45142.37475694445,"address":"대한민국 부산광역시 해운대구 구남로24번길 11","etc":"미잠금"},{"car":"TZ0083","lock":"열림","fuel":0,"lock_fuel":67,"lat":"35.131674698166165","lng":"129.10323181468334","lastest":45142.37461805555,"address":"대한민국 부산광역시 도로교통공단","etc":"미잠금"},{"car":"TZ0271","lock":"열림","fuel":14,"lock_fuel":95,"lat":"35.17801529120031","lng":"129.17451012495906","lastest":45142.66752314815,"address":"대한민국 부산광역시 대동상가","etc":"미잠금"},{"car":"TZ0132","lock":"열림","fuel":94,"lock_fuel":98,"lat":"35.155635540803495","lng":"129.1303786263568","lastest":45142.6665625,"address":"대한민국 부산광역시 수영구 민락동 113-60","etc":"미잠금"},{"car":"TZ0268","lock":"열림","fuel":39,"lock_fuel":98,"lat":"35.17623965149586","lng":"129.17810287308706","lastest":45142.66708333333,"address":"대한민국 부산광역시 해운대구 좌동 1303","etc":"미잠금"},{"car":"TZ0317","lock":"잠김","fuel":52,"lock_fuel":97,"lat":"35.14761743421032","lng":"129.0924781268202","lastest":45142.37166666667,"address":"대한민국 부산광역시 남구 대연동 산56-6","etc":"이탈"},{"car":"TZ0300","lock":"잠김","fuel":76,"lock_fuel":98,"lat":"35.11711866604402","lng":"129.084183271925","lastest":45142.3714699074,"address":"대한민국 부산광역시 감만동 178-1번지 2층 현대크리닝 남구 부산광역시 KR","etc":"이탈"},{"car":"TZ0418","lock":"잠김","fuel":71,"lock_fuel":98,"lat":"35.18461111269574","lng":"129.12189450912715","lastest":45142.37349537037,"address":"대한민국 부산광역시 해운대구 해운대로143번길 14","etc":"이탈"},{"car":"TZ0485","lock":"잠김","fuel":72,"lock_fuel":97,"lat":"35.18470868978671","lng":"129.12115035818888","lastest":45142.37383101852,"address":"대한민국 부산광역시 해운대구 재송동 1015-10","etc":"재배치"},{"car":"TZ0454","lock":"잠김","fuel":100,"lock_fuel":98,"lat":"35.17733144704283","lng":"129.12136415555784","lastest":45142.37520833333,"address":"대한민국 부산광역시 해운대구 재송동 1204","etc":"재배치"},{"car":"TZ0181","lock":"잠김","fuel":85,"lock_fuel":98,"lat":"35.17624648316992","lng":"129.1239882293032","lastest":45142.369375,"address":"대한민국 부산광역시 해운대구 재송동 1208-1","etc":"재배치"},{"car":"TZ0273","lock":"잠김","fuel":28,"lock_fuel":96,"lat":"35.193751088551686","lng":"129.1150529344972","lastest":45142.37185185185,"address":"대한민국 부산광역시 해운대구 재송동 1241-1","etc":"재배치"},{"car":"TZ0483","lock":"잠김","fuel":49,"lock_fuel":98,"lat":"35.19353654125061","lng":"129.1153522437071","lastest":45142.37530092592,"address":"대한민국 부산광역시 해운대구 재송동 1245","etc":"재배치"},{"car":"TZ0254","lock":"잠김","fuel":85,"lock_fuel":98,"lat":"35.19030401214508","lng":"129.116610188767","lastest":45142.37600694445,"address":"대한민국 부산광역시 해운대구 재송동 1347","etc":"재배치"},{"car":"TZ0240","lock":"잠김","fuel":61,"lock_fuel":98,"lat":"35.1877334115559","lng":"129.12036070432103","lastest":45142.37368055555,"address":"대한민국 부산광역시 해운대구 재송동 900-78","etc":"재배치"},{"car":"TZ0165","lock":"잠김","fuel":100,"lock_fuel":98,"lat":"35.18985441985928","lng":"129.11628656305064","lastest":45142.3753125,"address":"대한민국 부산광역시 해운대구 재송동 939-27","etc":"재배치"},{"car":"TZ0184","lock":"잠김","fuel":39,"lock_fuel":95,"lat":"35.18674307934545","lng":"129.11750319822633","lastest":45142.37105324074,"address":"대한민국 부산광역시 해운대구 수영강변대로 316","etc":"재배치"},{"car":"TZ0278","lock":"잠김","fuel":41,"lock_fuel":96,"lat":"35.182694457438295","lng":"129.1169575057987","lastest":45142.36973379629,"address":"대한민국 부산광역시 수영구 망미동 1129","etc":"재배치"},{"car":"TZ0004","lock":"잠김","fuel":0,"lock_fuel":57,"lat":"35.19451250964877","lng":"129.20902238539475","lastest":45142.66325231481,"address":"대한민국 부산광역시 기장군 기장읍 당사리 521","etc":"배터리"},{"car":"TZ0061","lock":"잠김","fuel":0,"lock_fuel":92,"lat":"35.14821297827582","lng":"129.06101680537267","lastest":45142.66622685185,"address":"대한민국 부산광역시 부산진구 범천동 858-23","etc":"배터리"},{"car":"TZ0409","lock":"잠김","fuel":0,"lock_fuel":63,"lat":"35.194893584064104","lng":"129.20871304182808","lastest":45142.66260416667,"address":"대한민국 부산광역시 기장군 기장읍 당사리 521","etc":"배터리"},{"car":"TZ0131","lock":"잠김","fuel":10,"lock_fuel":98,"lat":"35.15544716230997","lng":"129.1218454949086","lastest":45142.66533564815,"address":"대한민국 부산광역시 수영구 민락동 177-3","etc":"배터리"},{"car":"TZ0153","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.14375891002233","lng":"129.09827341005735","lastest":45142.66440972222,"address":"대한민국 부산광역시 대연삼정그린코아더베스트","etc":"배터리"},{"car":"TZ0160","lock":"잠김","fuel":10,"lock_fuel":95,"lat":"35.1610529398631","lng":"129.13076117682706","lastest":45142.66148148148,"address":"대한민국 부산광역시 수영구 민락동 1-24","etc":"배터리"},{"car":"TZ0237","lock":"잠김","fuel":10,"lock_fuel":97,"lat":"35.16820236367035","lng":"129.17393465874628","lastest":45142.66216435185,"address":"대한민국 부산광역시 해운대구 중동 262-32","etc":"배터리"},{"car":"TZ0301","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.12572574319402","lng":"129.1092122100792","lastest":45142.6615625,"address":"대한민국 부산광역시 남구 용호동 184-2","etc":"배터리"},{"car":"TZ0379","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.1558016366499","lng":"129.1237067463377","lastest":45142.66548611111,"address":"대한민국 부산광역시 수영구 민락동 176-40","etc":"배터리"},{"car":"TZ0440","lock":"잠김","fuel":10,"lock_fuel":96,"lat":"35.13908961377499","lng":"129.06417480042882","lastest":45142.66645833333,"address":"대한민국 부산광역시 동구 범일동 830-130","etc":"배터리"},{"car":"TZ0494","lock":"잠김","fuel":10,"lock_fuel":98,"lat":"35.15271499869341","lng":"129.12452207804682","lastest":45142.66583333333,"address":"대한민국 부산광역시 수영구 민락동 민락수변로 29","etc":"배터리"},{"car":"TZ0176","lock":"잠김","fuel":11,"lock_fuel":97,"lat":"35.158267197204395","lng":"129.11307646231933","lastest":45142.66722222222,"address":"대한민국 부산광역시 수영구 수영로 587","etc":"배터리"},{"car":"TZ0297","lock":"잠김","fuel":12,"lock_fuel":96,"lat":"35.15444256920601","lng":"129.1298905358795","lastest":45142.66414351852,"address":"대한민국 부산광역시 수영구 민락동 113-16","etc":"배터리"},{"car":"TZ0331","lock":"잠김","fuel":12,"lock_fuel":95,"lat":"35.135259591558686","lng":"129.09246484997377","lastest":45142.66421296296,"address":"대한민국 부산광역시 남구 대연동 1741-28","etc":"배터리"},{"car":"TZ0211","lock":"잠김","fuel":13,"lock_fuel":96,"lat":"35.13632561241744","lng":"129.0968322425969","lastest":45142.6649537037,"address":"대한민국 부산광역시 대연동 384-26번지 101동 504호 벽산이솔렌스힐3차 E--솔렌스힐 남구 부산광역시 KR","etc":"배터리"},{"car":"TZ0389","lock":"잠김","fuel":13,"lock_fuel":96,"lat":"35.14073827426112","lng":"129.10205091256273","lastest":45142.66393518518,"address":"대한민국 부산광역시 남구 대연동 110","etc":"배터리"},{"car":"TZ0271","lock":"열림","fuel":14,"lock_fuel":95,"lat":"35.17801529120031","lng":"129.17451012495906","lastest":45142.66752314815,"address":"대한민국 부산광역시 대동상가","etc":"배터리"},{"car":"TZ0029","lock":"잠김","fuel":14,"lock_fuel":95,"lat":"35.138999108113595","lng":"129.06776761119934","lastest":45142.66097222222,"address":"대한민국 부산광역시 남구 문현동 401-159","etc":"배터리"},{"car":"TZ0104","lock":"잠김","fuel":14,"lock_fuel":97,"lat":"35.13483254785305","lng":"129.11005118503624","lastest":45142.66359953704,"address":"대한민국 부산광역시 남구 대연동 1843","etc":"배터리"},{"car":"TZ0117","lock":"잠김","fuel":14,"lock_fuel":96,"lat":"35.13541649885721","lng":"129.0934910572484","lastest":45142.66251157408,"address":"대한민국 부산광역시 남구 못골로 104","etc":"배터리"},{"car":"TZ0472","lock":"잠김","fuel":14,"lock_fuel":96,"lat":"35.141422322974385","lng":"129.10886488090392","lastest":45142.66293981481,"address":"대한민국 부산광역시 남천동 22-5번지 수영구 부산광역시 KR","etc":"배터리"},{"car":"TZ0048","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.16747464286477","lng":"129.1179391714156","lastest":45142.66504629629,"address":"대한민국 부산광역시 수영구 광안동 44-19","etc":"배터리"},{"car":"TZ0088","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.138594167465","lng":"129.1086290219546","lastest":45142.66694444444,"address":"대한민국 부산광역시 남천동 556-18번지 남천동거북스포츠프라자 5층 수영구 부산광역시 KR","etc":"배터리"},{"car":"TZ0100","lock":"잠김","fuel":15,"lock_fuel":97,"lat":"35.160297529461545","lng":"129.16982357346748","lastest":45142.66538194445,"address":"대한민국 부산광역시 해운대구 중동 1833","etc":"배터리"},{"car":"TZ0106","lock":"잠김","fuel":15,"lock_fuel":97,"lat":"35.16053740345611","lng":"129.15821777203743","lastest":45142.66371527778,"address":"대한민국 부산광역시 해운대구 우동 634-13","etc":"배터리"},{"car":"TZ0204","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.15938831714233","lng":"129.15670046021876","lastest":45142.66303240741,"address":"대한민국 부산광역시 해운대구 해운대해변로209번가길 27","etc":"배터리"},{"car":"TZ0387","lock":"잠김","fuel":15,"lock_fuel":97,"lat":"35.136695735000714","lng":"129.06966965812788","lastest":45142.66456018519,"address":"대한민국 부산광역시 남구 문현동 367-23","etc":"배터리"},{"car":"TZ0399","lock":"잠김","fuel":15,"lock_fuel":97,"lat":"35.15420329594423","lng":"129.1284638849002","lastest":45142.66282407408,"address":"대한민국 부산광역시 수영구 민락동 113-47","etc":"배터리"},{"car":"TZ0405","lock":"잠김","fuel":15,"lock_fuel":96,"lat":"35.15724408312672","lng":"129.1247234964617","lastest":45142.6628125,"address":"대한민국 부산광역시 수영구 민락동 36-45","etc":"배터리"}]    

    // 주소 복사
    function copyToClipboard(val) {
        const t = document.createElement("textarea");
        document.body.appendChild(t);
        t.value = val;
        t.select();
        document.execCommand('copy');
        document.body.removeChild(t);
    }

    function copy(addr, carnum) {

        var jsonIdx = tourzy_bike.findIndex(function(key) {return key["car"] === carnum});
        
        var idx = JSON.stringify(jsonIdx);

        // console.log('idx : ' + idx)

        const onlongclick = ($target, duration, callback) => {

            $target.onmousedown = () => {
                const timer = setTimeout(callback, duration);

                $target.onmouseup = () => {
                clearTimeout(timer);
                };
            };  

            $target.ontouchstart = () => {
                const timer = setTimeout(callback, duration);

                $target.ontouchend = () => {
                clearTimeout(timer);
                };
            };  
        }

        // 코드예시
        const $target = document.querySelector('#html');

        onlongclick($target, 300, () => {

            alert('차량 번호 : ' + carnum + ' 작업을 완료했습니다.');
        });
        
        copyToClipboard(addr);

        $("#copied").show();

        self.setTimeout("hideDiv()", 2000);
    }
    
    $(document).ready(function () {

        $("#copied").hide();
    });
    // 주소 복사

    function hideDiv () {
        
        $("#copied").hide();
    }

    function mapLoad () {
        
        // $("#folium-map").html(JSON.stringify(XLSX.utils.sheet_to_json (sheet)));

        // console.log(JSON.stringify(XLSX.utils.sheet_to_json(sheet)))

        map = L.map("map", {
            center: [35.16380454089401, 129.1326448135078],
            crs: L.CRS.EPSG3857,
            zoom: 11,
            zoomControl: true,
            preferCanvas: false,
        });

        tile_layer = L.tileLayer(
            "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            {"attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
        ).addTo(map);

        for (let i = 0; i < tourzy_bike.length; i++) {

            // console.log(`${i} car:${tourzy_bike[i].car}, lat:${tourzy_bike[i].lat}, lng:${tourzy_bike[i].lng}`)

            // 시작
            marker = L.marker(
                [tourzy_bike[i].lat, tourzy_bike[i].lng],
                {}
            ).addTo(map);

            var icon_color = ''
            var icon_img = ''

            if (tourzy_bike[i].fuel <= 10) {

                icon_color = 'red'

            } else {

                icon_color = 'orange'
            }

            if (tourzy_bike[i].lock == '열림') {

                icon_img = 'ban-circle'

            } else {

                if (tourzy_bike[i].etc == 'GPS' || tourzy_bike[i].etc == '파손' || tourzy_bike[i].etc == '회수' || tourzy_bike[i].etc == '라이트') {

                    icon_img = 'plus-sign'

                } else if (tourzy_bike[i].etc == '이탈' || tourzy_bike[i].etc == '재배치') {

                    icon_img = 'refresh'
                    
                } else {

                    icon_img = 'flash'
                }
            }
        
            icon = L.AwesomeMarkers.icon(
                {"extraClasses": "fa-rotate-0", "icon": icon_img, "iconColor": "white", "markerColor": icon_color, "prefix": "glyphicon"}
            );
            marker.setIcon(icon);
        
            popup = L.popup({"maxWidth": "100%"});
            html = $(`<div id="html" onclick="copy('${tourzy_bike[i].address.replace("대한민국 ", "")}', '${tourzy_bike[i].car}')"; style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].car}<br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].fuel}%</div><br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].etc}</div></div>`)[0];
            popup.setContent(html);
            
            marker.bindPopup(popup);
            // 끝
        }
    }

    window.onload = function () {
        
        mapLoad ()
    }

</script>

<body>

    <div id="copied">주소가 복사되었습니다.</div>

    <div id="updated">UPDATED 2023.08.04. 16:00 총 52대
        <br/>
        금지 - 잠금 열린 차량 (6대)
        <br/>
        플러스 - 회수 후 정비가 필요한 차량 (4대)
        <br/>
        리프레쉬 - 재배치가 필요한 차량 (13대)
        <br/>
        번개 - 배터리 부족 빨간색 10% 이하, 주황색 10% 이상 20% 이하 (29대)
    </div>
    
    <div class="folium-map" id="map"></div>
        
</body>

</html>