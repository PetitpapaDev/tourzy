<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    
    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    
    <style>html, body {width: 100%; height: 100%; margin: 0; padding: 0;}</style>
    <style>#map {position:absolute; top:0; bottom:0; right:0; left:0;}</style>

    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
            
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <style>
        #map {
            position: relative;
            width: 100.0%;
            height: 100.0%;
            left: 0.0%;
            top: 0.0%;
        }

        #updated {
            width: 100%;
            text-align: center;
            position: fixed;
            top: 0%;
            padding-top: 10px;
            padding-bottom: 10px;

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            color: #000000;
            background: #FF7500;

            z-index: 9999;
        }

        #copied {
            width: 300px;
            height: 50px;
            text-align: center;
            position: fixed;
            bottom: 10%;
            left: 50%;
            transform: translate(-50%, 0%);

            font-family: NanumGothic;
            font-style: normal;
            font-weight: bold;
            font-size: 16px;
            line-height: 50px;
            color: #000000;
            background: #FF7500;
            border-radius: 10px;

            z-index: 9999;
        }
    </style>
        
</head>

<script>

    var map
    var tile_layer
    var marker
    var icon
    var popup
    var html

    var tourzy_bike = 

        [{"car":"TZ0452","lock":"잠김","fuel":0,"lat":35.2316303911781,"lng":129.084399692458,"address":"대한민국 부산광역시 금정구 장전동 402-5"},{"car":"TZ0383","lock":"잠김","fuel":0,"lat":35.1303214749559,"lng":129.103706000139,"address":"대한민국 부산광역시 남구 대연동 1916"},{"car":"TZ0043","lock":"잠김","fuel":0,"lat":35.1337316060722,"lng":129.101152165389,"address":"대한민국 부산광역시 남구 대연동 495-2"},{"car":"TZ0331","lock":"열림","fuel":0,"lat":35.1272391512067,"lng":129.108660416221,"address":"대한민국 부산광역시 남구 용호동 175-2"},{"car":"TZ0028","lock":"잠김","fuel":0,"lat":35.179931314444,"lng":129.076782971667,"address":"대한민국 부산광역시 부산시청"},{"car":"TZ0489","lock":"잠김","fuel":0,"lat":35.1774158978179,"lng":129.074886289615,"address":"대한민국 부산광역시 부산진구 양정동 중앙대로 990"},{"car":"TZ0465","lock":"잠김","fuel":10,"lat":35.1570988991963,"lng":129.113227099813,"address":"대한민국 부산광역시 수영구 광안동 485-13"},{"car":"TZ0298","lock":"열림","fuel":0,"lat":35.142081793369,"lng":129.106076776156,"address":"대한민국 부산광역시 수영구 남천동 75-31"},{"car":"TZ0166","lock":"잠김","fuel":0,"lat":35.1833314880776,"lng":129.116940723345,"address":"대한민국 부산광역시 수영구 망미동 1090-2"},{"car":"TZ0460","lock":"잠김","fuel":0,"lat":35.1556012778385,"lng":129.123368195109,"address":"대한민국 부산광역시 수영구 민락동 176-33"},{"car":"TZ0210","lock":"잠김","fuel":0,"lat":35.167562764226,"lng":129.129748898583,"address":"대한민국 부산광역시 신세계센텀시티"},{"car":"TZ0491","lock":"열림","fuel":0,"lat":35.1869128296307,"lng":129.07341729874,"address":"대한민국 부산광역시 연제구 거제대로 222"},{"car":"TZ0026","lock":"잠김","fuel":0,"lat":35.1785902372778,"lng":129.076194059942,"address":"대한민국 부산광역시 연제구 연산동 1422-6"},{"car":"TZ0466","lock":"잠김","fuel":0,"lat":35.1799469896285,"lng":129.076661776507,"address":"대한민국 부산광역시 연제구 연산동 1444-7"},{"car":"TZ0492","lock":"잠김","fuel":0,"lat":35.1774699273232,"lng":129.07557609247,"address":"대한민국 부산광역시 연제구 연산동 1476-5"},{"car":"TZ0378","lock":"잠김","fuel":0,"lat":35.1799345737505,"lng":129.076766162026,"address":"대한민국 부산광역시 연제구 중앙대로 지하 1017"},{"car":"TZ0103","lock":"잠김","fuel":0,"lat":35.1695172588803,"lng":129.156242106024,"address":"대한민국 부산광역시 해운대구 우동 352-4"},{"car":"TZ0280","lock":"잠김","fuel":0,"lat":35.1635822186104,"lng":129.158441758913,"address":"대한민국 부산광역시 해운대구 우동 524-14"},{"car":"TZ0243","lock":"잠김","fuel":0,"lat":35.1636942474662,"lng":129.158690693021,"address":"대한민국 부산광역시 해운대구 우동 524-17"},{"car":"TZ0273","lock":"잠김","fuel":0,"lat":35.1615211577487,"lng":129.159478271804,"address":"대한민국 부산광역시 해운대구 우동 542-29"},{"car":"TZ0278","lock":"잠김","fuel":0,"lat":35.1604946978189,"lng":129.156325670666,"address":"대한민국 부산광역시 해운대구 우동 657"},{"car":"TZ0034","lock":"잠김","fuel":0,"lat":35.1632372035411,"lng":129.158464758154,"address":"대한민국 부산광역시 해운대구 우제1동 539-3"},{"car":"TZ0079","lock":"잠김","fuel":0,"lat":35.1631956944748,"lng":129.158416588244,"address":"대한민국 부산광역시 해운대구 우제1동 539-3"},{"car":"TZ0349","lock":"잠김","fuel":0,"lat":35.1631787337322,"lng":129.158463504894,"address":"대한민국 부산광역시 해운대구 우제1동 539-3"},{"car":"TZ0223","lock":"잠김","fuel":0,"lat":35.174659934523,"lng":129.174417809173,"address":"대한민국 부산광역시 해운대구 좌동 1295-18"},{"car":"TZ0355","lock":"잠김","fuel":0,"lat":35.1746452232014,"lng":129.174272260115,"address":"대한민국 부산광역시 해운대구 좌동 1295-18"},{"car":"TZ0244","lock":"잠김","fuel":0,"lat":35.1716698188661,"lng":129.171584079825,"address":"대한민국 부산광역시 해운대구 중동 228-3"},{"car":"TZ0023","lock":"잠김","fuel":0,"lat":35.1638921820995,"lng":129.169978383443,"address":"엘시티"}]    
    
    // 주소 복사
    function copyToClipboard(val) {
        const t = document.createElement("textarea");
        document.body.appendChild(t);
        t.value = val;
        t.select();
        document.execCommand('copy');
        document.body.removeChild(t);
    }

    function copy(addr, carnum) {

        var jsonIdx = tourzy_bike.findIndex(function(key) {return key["car"] === carnum});
        
        var idx = JSON.stringify(jsonIdx);

        // console.log('idx : ' + idx)

        const onlongclick = ($target, duration, callback) => {

            $target.onmousedown = () => {
                const timer = setTimeout(callback, duration);

                $target.onmouseup = () => {
                clearTimeout(timer);
                };
            };  

            $target.ontouchstart = () => {
                const timer = setTimeout(callback, duration);

                $target.ontouchend = () => {
                clearTimeout(timer);
                };
            };  
        }

        // 코드예시
        const $target = document.querySelector('#html');

        onlongclick($target, 300, () => {

            alert('차량 번호 : ' + carnum + ' 작업을 완료했습니다.');

            mapLoad()
        });
        
        copyToClipboard(addr);

        $("#copied").show();

        self.setTimeout("hideDiv()", 2000);
    }

    $(document).ready(function () {

        $("#copied").hide();
    });
    // 주소 복사

    function hideDiv () {
        
        $("#copied").hide();
    }

    function mapLoad () {
        
        // $("#folium-map").html(JSON.stringify(XLSX.utils.sheet_to_json (sheet)));

        // console.log(JSON.stringify(XLSX.utils.sheet_to_json(sheet)))

        map = L.map("map", {
            center: [35.16380454089401, 129.1326448135078],
            crs: L.CRS.EPSG3857,
            zoom: 11,
            zoomControl: true,
            preferCanvas: false,
        });

        tile_layer = L.tileLayer(
            "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
            {"attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
        ).addTo(map);

        for (let i = 0; i < tourzy_bike.length; i++) {

            // console.log(`${i} car:${tourzy_bike[i].car}, lat:${tourzy_bike[i].lat}, lng:${tourzy_bike[i].lng}`)

            // 시작
            marker = L.marker(
                [tourzy_bike[i].lat, tourzy_bike[i].lng],
                {}
            ).addTo(map);

            var icon_color = ''

            if (tourzy_bike[i].fuel <= 10) {

                icon_color = 'red'

            } else {

                icon_color = 'orange'
            }
        
            icon = L.AwesomeMarkers.icon(
                {"extraClasses": "fa-rotate-0", "icon": "flag", "iconColor": "white", "markerColor": icon_color, "prefix": "glyphicon"}
            );
            marker.setIcon(icon);
        
            popup = L.popup({"maxWidth": "100%"});
            html = $(`<div id="html" onclick="copy('${tourzy_bike[i].address.replace("대한민국 ", "")}', '${tourzy_bike[i].car}')"; style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].car}<br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].fuel}%</div></div>`)[0];
            popup.setContent(html);
            
            marker.bindPopup(popup);
            // 끝
        }
    }

    window.onload = function () {
        
        mapLoad ()
    }

    // $(document).ready(function () {
        
    //     var map = L.map("map", {
    //         center: [35.16380454089401, 129.1326448135078],
    //         crs: L.CRS.EPSG3857,
    //         zoom: 11,
    //         zoomControl: true,
    //         preferCanvas: false,
    //     });

    //     var tile_layer = L.tileLayer(
    //         "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
    //         {"attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false}
    //     ).addTo(map);

    //     for (let i = 0; i < tourzy_bike.length; i++) {

    //         // console.log(`${i} car:${tourzy_bike[i].car}, lat:${tourzy_bike[i].lat}, lng:${tourzy_bike[i].lng}`)

    //         // 시작
    //         var marker = L.marker(
    //             [tourzy_bike[i].lat, tourzy_bike[i].lng],
    //             {}
    //         ).addTo(map);

    //         var icon_color = ''

    //         if (tourzy_bike[i].fuel <= 10) {

    //             icon_color = 'red'

    //         } else {

    //             icon_color = 'orange'
    //         }
        
    //         var icon = L.AwesomeMarkers.icon(
    //             {"extraClasses": "fa-rotate-0", "icon": "flag", "iconColor": "white", "markerColor": icon_color, "prefix": "glyphicon"}
    //         );
    //         marker.setIcon(icon);
        
    //         var popup = L.popup({"maxWidth": "100%"});
    //         var html = $(`<div id="html" onclick="copy('${tourzy_bike[i].address.replace("대한민국 ", "")}', '${tourzy_bike[i].car}')"; style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].car}<br /><div id="html" style="width: 100.0%; height: 100.0%;">${tourzy_bike[i].fuel}%</div></div>`)[0];
    //         popup.setContent(html);
            
    //         marker.bindPopup(popup);
    //         // 끝
    //     }
    // });

</script>

<body>

    <div id="copied">주소가 복사되었습니다.</div>

    <div id="updated">UPDATED 2023.07.14. 09:28 총 28대
        <br/>
        빨간색 15% 이하
        <br/>
        주황색 15% 이상 30% 이하
    </div>
    
    <div class="folium-map" id="map"></div>
        
</body>

</html>